{% extends 'base.html' %} {% load static %} {% load crispy_forms_tags %}

{% block content %}
<div class="form-container">

    <!------------------------------------------------ SALE FORM ------------------------------------------------------------------------->

{% if product.category.name == 'sale' %}
    <form action="{% url 'product_detail' product.id %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <fieldset>
            <legend class="fieldset-label">
                <i class="far fa-address-book"></i>
                Contact Info 
                <a data-bs-toggle="collapse" href="#contactInfo" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">
                    <i class="fas fa-angle-down"></i>
                </a>
            </legend>
            <div class="collapse multi-collapse show" id="contactInfo">
                <hr>
                {{ listing_form.company_name | as_crispy_field }}
                {{ listing_form.full_name | as_crispy_field }}
                {{ listing_form.email | as_crispy_field }}
                <div class="row">
                    <div class="col">
                        {{ listing_form.phone | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.call_between_hrs | as_crispy_field }}
                    </div>
                </div>
            </div>
        </fieldset>
        <hr>
        <fieldset>
            <legend class="fieldset-label">
                <i class="fas fa-map-pin"></i>
                Location of Property
                <a data-bs-toggle="collapse" href="#propertyLocation" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">
                    <i class="fas fa-angle-down"></i>
                </a>
            </legend>
            <div class="collapse multi-collapse" id="propertyLocation">
                <hr>
                <div class="row">
                    <div class="col">
                        {{ listing_form.county | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.area | as_crispy_field }}
                    </div>
                    {{ listing_form.eircode | as_crispy_field }}
                </div>
            </div>
        </fieldset>
        <hr>
        <fieldset>
            <legend class="fieldset-label">
                <i class="fas fa-home"></i>
                Property Info
                <a data-bs-toggle="collapse" href="#propertyInfo" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">
                    <i class="fas fa-angle-down"></i>
                </a>
            </legend>
            <div class="collapse multi-collapse" id="propertyInfo">
            <hr>
                <div class="row">
                    <div class="col">
                        {{ listing_form.property_type | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.selling_type | as_crispy_field }}
                    </div>
                </div>
                {{ listing_form.price | as_crispy_field }}
                <div class="row">
                    <div class="col">
                        {{ listing_form.no_of_bedrooms | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.no_of_bathrooms | as_crispy_field }}
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        {{ listing_form.facility_1 | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.facility_2 | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.facility_3 | as_crispy_field }}
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        {{ listing_form.facility_4 | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.facility_5 | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.facility_6 | as_crispy_field }}
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        {{ listing_form.floor_area_type | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.floor_area | as_crispy_field }}
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        {{ listing_form.ber_rating | as_crispy_field }}
                    </div>
                    <div class="col">
                        {{ listing_form.tax_designation | as_crispy_field }}
                    </div>
                </div>
                <div class="features">
                    {{ listing_form.top_features_1 | as_crispy_field }}
                </div>
                <div class="features" hidden>
                    {{ listing_form.top_features_2 | as_crispy_field }}
                </div>
                <div class="features" hidden>
                    {{ listing_form.top_features_3 | as_crispy_field }}
                </div>
                <div class="features" hidden>
                    {{ listing_form.top_features_4 | as_crispy_field }}
                </div>
                <div class="features" hidden>
                    {{ listing_form.top_features_5 | as_crispy_field }}            
                </div>
                {{ listing_form.description | as_crispy_field }}
                {{ listing_form.header_image | as_crispy_field }}
                <!-- To display image from header image -->
                <div class="header-image-preview">
                </div>
                {{ images_form | crispy }}
                <!-- To display images from images form -->
                <div class="image-preview">
                </div>
            </div>
        </fieldset>
        <hr>
        <button class="btn form-btn" id="submitBtn">Continue to payment</button>
    </form>

{% else %}

    <!------------------------------------------------ RENT FORM ------------------------------------------------------------------------->

    <form action="{% url 'product_detail' product.id %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <fieldset>
            <legend class="fieldset-label">
                <i class="far fa-address-book"></i>
                Contact Info
            </legend>
            {{ listing_form.company_name | as_crispy_field }}
            {{ listing_form.full_name | as_crispy_field }}
            {{ listing_form.email | as_crispy_field }}
            {{ listing_form.phone | as_crispy_field }}
            {{ listing_form.call_between_hrs | as_crispy_field }}
            <hr>
        </fieldset>
        <hr>
        <fieldset>
            <legend class="fieldset-label">
                <i class="fas fa-map-pin"></i>
                Location of Property
            </legend>
            {{ listing_form.county | as_crispy_field }}
            {{ listing_form.area | as_crispy_field }}
            {{ listing_form.eircode | as_crispy_field }}
            <hr>
        </fieldset>
        <hr>
        <fieldset>
            <legend class="fieldset-label">
                <i class="fas fa-home"></i>
                Property Info
            </legend>
            {{ listing_form.property_type | as_crispy_field }}
            {{ listing_form.rent_type | as_crispy_field }}
            {{ listing_form.price | as_crispy_field }}
            {{ listing_form.available_from | as_crispy_field }}
            {{ listing_form.lease_term | as_crispy_field }}
            {{ listing_form.no_of_single_bedrooms | as_crispy_field }}
            {{ listing_form.no_of_double_bedrooms | as_crispy_field }}
            {{ listing_form.no_of_twin_bedrooms | as_crispy_field }}
            {{ listing_form.no_of_bathrooms | as_crispy_field }}
            {{ listing_form.furnishing | as_crispy_field }}
            {{ listing_form.facility_1 | as_crispy_field }}
            {{ listing_form.facility_2 | as_crispy_field }}
            {{ listing_form.facility_3 | as_crispy_field }}
            {{ listing_form.facility_4 | as_crispy_field }}
            {{ listing_form.facility_5 | as_crispy_field }}
            {{ listing_form.facility_6 | as_crispy_field }}
            {{ listing_form.floor_area_type | as_crispy_field }}
            {{ listing_form.floor_area | as_crispy_field }}
            {{ listing_form.ber_rating | as_crispy_field }}
            {{ listing_form.description | as_crispy_field }}
            {{ listing_form.header_image | as_crispy_field }}
            <!-- To display image from header image -->
            <div class="header-image-preview">
            </div>
            {{ images_form | crispy }}
            <!-- To display images from images form -->
            <div class="image-preview">
            </div>
            <hr>
        </fieldset>
        <hr>
        <button class="btn form-btn" id="submitBtn">Continue to payment</button>
    </form>
{% endif %}
    <div class="divider"></div>

</div>


<script>
    function readHeaderURL(input){
        document.querySelector('.header-image-preview').innerHTML = '';
        if (input.files && input.files[0]) {
            var files = input.files
            
            for (let file of files) {
                console.log(file);
                let img = new Image;
                img.src = URL.createObjectURL(file);
                console.log(img);
                
                document.querySelector('.header-image-preview').appendChild(img);
            }

        }
    }

    function readURL(input){
        document.querySelector('.image-preview').innerHTML = '';
        if (input.files && input.files[0]) {
            var files = input.files
            console.log(files);
            
            for (let file of files) {
                console.log(file);
                let img = new Image;
                img.src = URL.createObjectURL(file);
                console.log(img);
                document.querySelector('.image-preview').appendChild(img);
            }

        }
    }

    function displayFeatures() {
        $('.features').keyup(function (){
            $(this).next('.features').attr('hidden', false);
            if ($(this).find('.textInput').val() == '') {
                $(this).next('.features').attr('hidden', true);
            }
        });
    }
    displayFeatures();
</script>

<!-- <script>
    document.addEventListener('DOMContentLoaded', function() {
        var files =[]
        const inputElement = document.querySelector('input[type="file"]');
        const pond = FilePond.create( inputElement, {
            onaddfile: (err, fileItem) => {
                files.push(fileItem.file)
                console.log(files)
            },
            onremovefile:(err, fileItem) => {
                const index = files.indexOf(fileItem.file)
                if (index > -1) {
                    files.splice(index, 1)
                }
                console.log(files)
            }
        } );

        var formData = new FormData();
        $(document).on('click', '#submitBtn', function(e) {
            formData.append('length', files.length)
            for (i = 0; i < files.length; i++) {
                formData.append('images' + i, files[i])
            }

            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}')
            
            $.ajax({
                type: 'POST',
                url: '{% url "product_detail" product.id %}',
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                enctype: 'multipart/form-data',
                success: function() {
                    alert('The listing was created')
                },
                error: function(xhr, errmsg, err) {
                    console.log(xhr.status + ":" + xhr.responseText)
                }
            })

        });

    });
</script> -->
{% endblock %}